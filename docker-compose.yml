version: "3.9"

services:
  oracle_performance_mcp:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: oracle_performance_mcp

    ports:
      - "${MCP_PORT:-8300}:${MCP_PORT:-8300}"

    # ðŸ”¥ Hot reload for BOTH code and settings.yaml
    volumes:
      - ./server:/app
      - ./server/config/settings.yaml:/app/config/settings.yaml:ro
      - ./server/data:/app/data

    env_file:
      - .env

    environment:
      MCP_PORT: ${MCP_PORT:-8300}
      UVICORN_RELOAD: "true"
      KNOWLEDGE_DB_HOST: ${KNOWLEDGE_DB_HOST:-host.docker.internal}
      KNOWLEDGE_DB_PORT: ${KNOWLEDGE_DB_PORT:-5433}
      KNOWLEDGE_DB_NAME: ${KNOWLEDGE_DB_NAME:-omni}
      KNOWLEDGE_DB_USER: ${KNOWLEDGE_DB_USER:-postgres}
      KNOWLEDGE_DB_PASSWORD: ${KNOWLEDGE_DB_PASSWORD:-postgres}

    restart: unless-stopped
